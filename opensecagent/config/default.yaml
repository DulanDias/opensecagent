# OpenSecAgent - Default Configuration
# Override via OPENSECAGENT_CONFIG or --config

agent:
  name: opensecagent
  version: "0.1.0"
  data_dir: /var/lib/opensecagent
  log_dir: /var/log/opensecagent
  run_dir: /run/opensecagent

# Environment: dev | staging | prod
environment: prod

# Policy: action tier allowed (0=alert only, 1=soft containment, 2=strong, 3=emergency)
action_tier_max: 1

# Maintenance windows (no Tier-1+ actions during these; UTC)
maintenance_windows: []

# Collectors
collector:
  host_interval_sec: 300
  docker_interval_sec: 60
  drift_interval_sec: 300
  critical_files:
    - /etc/passwd
    - /etc/group
    - /etc/sudoers
    - /etc/ssh/sshd_config
    - /etc/hosts
    - /etc/crontab
    - /etc/cron.d
    # dirs as glob
    - /etc/cron.d/*

# Detectors
detector:
  detector_interval_sec: 60
  auth_failure_threshold: 5
  auth_failure_window_sec: 300
  baseline_learning_days: 3
  resource_detector_enabled: true
  resource_cpu_percent: 90
  resource_memory_percent: 90
  network_detector_enabled: true
  network_mb_per_sec_threshold: 100
  nginx_audit_enabled: true
  nginx_config_paths: ["/etc/nginx/nginx.conf"]
  nginx_check_security: true
  firewall_audit_enabled: true
  firewall_require_active: true
  npm_audit_enabled: true
  npm_audit_paths: ["/var/www", "/opt", "/home"]
  npm_audit_max_depth: 4

# Notifications
notifications:
  admin_emails: []
  smtp:
    host: ""
    port: 587
    use_tls: true
    user: ""
    password: ""
    from: "OpenSecAgent <noreply@localhost>"
  immediate_severities: [P1, P2]
  digest:
    enabled: true
    hour_utc: 8
    minute: 0

# LLM (optional; leave empty for local-only)
llm:
  enabled: false
  provider: openai
  api_key: ""
  model: gpt-4o-mini
  base_url: ""  # for OpenAI-compatible endpoints
  max_tokens: 2048
  agent_max_iterations: 10
  # Redact before sending
  redact_patterns: ["password", "secret", "token", "key", "credential"]

# Control plane (optional)
control_plane:
  enabled: false
  url: ""
  agent_key: ""

# Audit
audit:
  file: /var/log/opensecagent/audit.jsonl
  max_size_mb: 100
  retain_days: 90

# Full activity log (every collector, detector, command, LLM call)
activity:
  enabled: true
  file: /var/log/opensecagent/activity.jsonl
  log_dir: /var/log/opensecagent

# LLM Agent (command loop: suggest → execute → feedback)
llm_agent:
  enabled: false
  run_on_incident: true   # run agent loop when P1/P2 incident detected
  run_interval_sec: 3600  # or run periodically (0 = disabled)
  agent_max_iterations: 10
